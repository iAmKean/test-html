import{a as P}from"./dateHelper-f75861f0.js";import{_ as E}from"./AppBreadcrumbs-734e5808.js";import"./AppLoader.vue_vue_type_style_index_0_lang-2e650906.js";/* empty css                                                               */import{o as l,c as o,a as e,e as H,r as i,l as U,R as I,h as p,u as f,t as r,b as D,C as h,j as T,n as y,F as Z,k as z}from"./index-0d29c91c.js";import{_ as R}from"./AppLoader-c0c74b58.js";import{f as X,a as Y}from"./loyalty-181b1cf0.js";import{X as j}from"./main-044273c3.js";import"./axiosConfig-15342d77.js";const q=e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14.277",height:"16.242",viewBox:"0 0 14.277 16.242"},[e("path",{id:"ico-filter",d:"M5,4A1,1,0,0,0,3,4v7.268a2,2,0,0,0,0,3.464V16a1,1,0,0,0,2,0V14.732a2,2,0,0,0,0-3.464Zm6,0A1,1,0,0,0,9,4V5.268A2,2,0,0,0,9,8.732V16a1,1,0,0,0,2,0V8.732a2,2,0,0,0,0-3.464Zm5-1a1,1,0,0,1,1,1v7.268a2,2,0,0,1,0,3.464V16a1,1,0,0,1-2,0V14.732a2,2,0,0,1,0-3.464V4A1,1,0,0,1,16,3Z",transform:"matrix(0.017, 1, -1, 0.017, 16.963, -2.052)",fill:"#046a38"})],-1),O=[q],G={__name:"ico-filter",props:{size:{type:[String,Number],default:"26px"},active:{type:Boolean,default:!1},color:{type:String,default:"#046a38"}},setup(N){return(v,A)=>(l(),o("div",null,O))}};const J={class:"mb-16 loyalty-points"},K={class:"bg-white px-36 py-4"},Q=e("div",{class:"mt-[9px] text-[34px] leading-9 font-bold"}," My Points ",-1),W={class:"mt-5 flex justify-center"},ee={class:"card bg-white w-1/2 rounded-sm text-primary"},te={class:"my-5 flex flex-col items-center font-bold"},se={class:"text-[34px] leading-9"},ae=e("div",{class:""},"Total Available Points",-1),le=e("div",{class:"border-t border-[#86D295]"},null,-1),oe={class:"flex flex-col gap-2 text-primary px-5 py-2 mb-5"},ne={class:"flex justify-between"},ie={class:"font-bold"},re=["value"],de={key:0},ce={class:"font-bold"},ue={class:"card bg-white w-1/2 rounded-sm text-primary py-3 px-5"},ve={class:"flex justify-between"},_e=e("div",{class:"text-base font-bold"},"Transaction History",-1),me={class:"flex leading-4 font-medium gap-[11px]"},pe=e("div",null,"Filter",-1),fe={key:0,class:"mt-[22px] text-black font-medium"},xe=e("div",{class:"text-base"},"Select transaction period",-1),he={class:"flex gap-4 items-end"},ye={class:"flex-1"},ge=e("label",{class:"font-medium",for:"start-date"},"From",-1),be={class:"flex-1"},we=e("label",{class:"font-medium",for:"start-date"},"To",-1),ke={class:"flex flex-col w-2/3"},Ve={class:"font-bold truncate"},Me={class:"mt-[15px] text-xs"},De={key:0},Ae={key:1},Fe={key:1,class:"relative my-10"},Le={key:0},Ce={key:1,class:"mt-16 mb-[300px] text-center"},Pe=e("div",{class:"text-sm leading-6 font-bold"},"No transaction yet",-1),Te=e("div",{class:"mt-1 text-xs"}," After your first transaction, you will be able to view it here. ",-1),je=[Pe,Te],ze={__name:"index",setup(N){const v=H(),A=[{active:!1,label:"My Loyalty",to:"/loyalty"},{active:!0,label:"My Points"}],c=i(null),u=i(null);var g=null,b=null;const _=i(!1),x=i([]),w=i(!1),m=i(!1),F=10,k=i(0),d=i(!0),n=i({}),S=async()=>{try{const s=await X();console.log(s.data),n.value=s.data}catch{}},$=()=>{const{accumulated_points:s,current_level_threshold:a,next_level_threshold:t}=n.value;return(s-a)/(t-a)*100},V=async()=>{m.value=!0;try{const s=await Y({date_from:g?P(new Date(g)):null,date_to:b?P(new Date(b)):null,limit:F,offset:k.value});w.value&&(_.value=!1),s.data.length&&(x.value.push(...s.data),k.value+=s.data.length),s.data.length<F&&(d.value=!1)}catch(s){v.alertModal={state:!0,content:s.response.data.errors[Object.keys(s.response.data.errors)[0]][0]},d.value=!1}m.value=!1},B=async()=>{if(x.value=[],k.value=0,d.value=!0,!c.value&&u.value){v.alertModal={state:!0,content:"Please input a date from value."},d.value=!1;return}if(!u.value&&c.value){v.alertModal={state:!0,content:"Please input a date to value."},d.value=!1;return}const s=new Date(c.value).getTime();if(new Date(u.value).getTime()<s){v.alertModal={state:!0,content:"The date to must be a date after or equal to date from."},d.value=!1;return}g=c.value,b=u.value,w.value=!0,await V(),w.value=!1},L=i(null),C=async s=>{let a=L.value;a&&a.getBoundingClientRect().bottom<window.innerHeight&&d.value&&!m.value&&await V()};return U(()=>{S(),V(),window.addEventListener("scroll",C)}),I(()=>{window.removeEventListener("scroll",C)}),(s,a)=>(l(),o("div",J,[e("div",K,[p(f(E),{class:"",items:A}),Q]),e("div",W,[e("div",ee,[e("div",te,[e("div",se,r(parseInt(n.value.points)||"0"),1),ae]),le,e("div",oe,[e("div",ne,[e("div",ie,r(n.value.level||"Level 0"),1),e("div",null," accumulated points ("+r(parseInt(n.value.accumulated_points)||0)+") ",1)]),e("progress",{class:"progress progress-primary bg-[#86D295]",value:n.value.next_level?$():100,max:"100"},null,8,re),n.value.next_level?(l(),o("div",de,[D(" Earn "),e("span",ce,r(parseInt(n.value.next_level_threshold-n.value.accumulated_points)),1),D(" points to unlock "+r(n.value.next_level),1)])):h("",!0)])])]),e("div",{class:"mt-5 flex justify-center text-sm leading-6",ref_key:"scrollComponent",ref:L},[e("div",ue,[e("div",ve,[_e,e("div",me,[pe,p(f(G),{onClick:a[0]||(a[0]=t=>_.value=!_.value)})])]),_.value?(l(),o("div",fe,[xe,e("div",he,[e("div",ye,[ge,p(f(j),{"input-class-name":"dp-custom-input","text-input":"",modelValue:c.value,"onUpdate:modelValue":a[1]||(a[1]=t=>c.value=t),format:"Y-MM-dd","week-start":"1","auto-apply":"","max-date":new Date},null,8,["modelValue","max-date"])]),e("div",be,[we,p(f(j),{"input-class-name":"dp-custom-input","text-input":"",modelValue:u.value,"onUpdate:modelValue":a[2]||(a[2]=t=>u.value=t),format:"Y-MM-dd","week-start":"1","auto-apply":"","max-date":new Date},{"calendar-header":T(({index:t,day:M})=>[e("div",{class:y(t===5||t===6?"text-red-500":"")},r(M),3)]),"time-picker":T(({})=>[]),_:1},8,["modelValue","max-date"])]),e("button",{class:y(["btn btn-primary px-10 py-4"]),onClick:a[3]||(a[3]=t=>B())}," Filter ")])])):h("",!0),e("div",{class:y(["flex flex-col gap-5 pr-4",_.value?"mt-[19px]":"mt-[22px]"])},[(l(!0),o(Z,null,z(x.value,(t,M)=>(l(),o("div",{class:"flex justify-between text-[#000000DE] items-center",key:M},[e("div",ke,[e("div",Ve,r(t.message),1),e("div",Me,[e("div",null,r(t.status.charAt(0).toUpperCase()+t.status.slice(1)),1),e("div",null,r(t.created_at),1)])]),e("div",{class:y(["font-bold",{"text-[#FF1F1F]":["redeemed"].includes(t.status)},{"text-primary":["granted"].includes(t.status)},{"text-[#A8A8A8]":["pending","void"].includes(t.status)}])},[["grant"].includes(t.transaction)?(l(),o("span",De,"+")):(l(),o("span",Ae,"-")),D(r(Math.floor(t.points))+" Points ",1)],2)]))),128))],2),m.value?(l(),o("div",Fe,[p(f(R))])):h("",!0)])],512),m.value?(l(),o("span",Le)):x.value.length?h("",!0):(l(),o("div",Ce,je))]))}};export{ze as default};
