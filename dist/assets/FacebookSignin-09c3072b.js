import{_ as h}from"./logo-Hotel101-c40e9d3c.js";import{s as v,e as x,g as y,l as B,K as S,c as M,G as R,z as b,d as F,A as w,a8 as T,a9 as A,W as I,o as P,a as r}from"./index-0d29c91c.js";const j={class:"flex-1 pt-[186.94px] flex flex-col"},Y=r("div",{class:"flex justify-center"},[r("img",{class:"cursor-pointer h-[60px]",src:h,alt:"hotel101-logo"})],-1),L=r("div",{class:"w-[309px] flex flex-col justify-center mx-auto text-center"},[r("div",{class:"mt-8 font-medium text-xl leading-6"}," Signing in... ")],-1),N=[Y,L],z={__name:"FacebookSignin",setup(O){const _=R.FB_APP_ID,l=v(),n=x(),u=b(),f=F(),m=w("$cookies");var e=null,i=null;const c=()=>{i&&clearTimeout(i),e&&(i=setTimeout(()=>{u.push(e),e=null},5e3))};y(()=>n.alertModal.state,t=>{!t&&e&&(i=null,u.push(e),e=null)});const g=async(t,a)=>{var s=T(t.userId,t.accessToken),o=await A("facebook",s),d={type:"facebook",token:s};o.status==200?(l.login(m,d),e={name:"BaseRoute::home"},n.alertModal={state:!0,icon:"confirmation",content:"You have successfully logged in using your Facebook account."},c()):o.status==404?(console.log("Social email not in registered. Registering new user..."),p(a,d)):(e={name:"BaseRoute::login"},n.alertModal={state:!0,content:o.data.message},c())},p=async(t,a)=>{var s={first_name:t.first_name,middle_name:t.middle_name??null,last_name:t.last_name,driver:a.type,token:a.token,terms:!0,email_optin:!0},o=await I(s);o.status==201?(l.login(m,a),e={name:"BaseRoute::home"},n.alertModal={state:!0,icon:"confirmation",content:"You have successfully logged in using your Facebook account."},c()):(e={name:"BaseRoute::login"},n.alertModal={state:!0,content:o.data.message},c())};B(()=>{let a=new URLSearchParams(f.hash).get("access_token");a&&FB.api("/me?fields=first_name,middle_name,last_name,email",{access_token:a},function(s){var o={userId:s.id,accessToken:a};s.email?g(o,s):(e={name:"BaseRoute::login"},n.alertModal={state:!0,content:"You don't have a registered email in your Facebook account. Please set it up first."},c())})});const k=async()=>{FB.init({appId:_,cookie:!0,version:"v17.0"})};return S(async()=>{await k()}),(t,a)=>(P(),M("div",j,N))}};export{z as default};
